# 星盘合盘业务流程图 V1.0

## 用户旅程全景图

```mermaid
graph TD
    Start([新用户下载]) --> Install{安装成功?}
    Install -->|是| Register[注册基础信息]
    Install -->|否| End1([流失])
    
    Register --> AstroOnboard{愿意提供出生信息?}
    AstroOnboard -->|是| BirthInfo[采集生日/时间/城市]
    AstroOnboard -->|否| SkipAstro[跳过星盘信息]
    
    BirthInfo --> GenerateProfile[生成缘分画像]
    GenerateProfile --> Home[进入首页]
    SkipAstro --> Home
    
    Home --> MatchTab{选择匹配方式}
    MatchTab -->|天选| DestinyFeed[今日天选推荐]
    MatchTab -->|附近| NearbyFeed[附近可聊]
    
    DestinyFeed --> AstroBadge[显示缘分徽章]
    NearbyFeed --> NormalCard[普通用户卡片]
    
    AstroBadge --> ClickBadge{点击徽章?}
    ClickBadge -->|是| LightReport[轻报告弹层]
    ClickBadge -->|否| SwipeAction{滑动操作}
    
    LightReport --> CopyOpener{复制开场白?}
    CopyOpener -->|是| StartChat[开始对话]
    CopyOpener -->|否| DeepReport{查看深报告?}
    
    DeepReport -->|是| Paywall[订阅页面]
    DeepReport -->|否| StartChat
    
    SwipeAction -->|喜欢| Like[发送喜欢]
    SwipeAction -->|跳过| NextCard[下一张卡片]
    
    Like --> Match{匹配成功?}
    Match -->|是| MatchDialog[匹配弹窗+开场白]
    Match -->|否| NextCard
    
    MatchDialog --> StartChat
    StartChat --> ChatScreen[聊天界面]
    
    ChatScreen --> ChatBanner[顶部建议横条]
    ChatBanner --> ChatInput[输入区开场白按钮]
    
    ChatInput --> SendMessage[发送消息]
    SendMessage --> ActiveConvo{有效对话?}
    
    ActiveConvo -->|是| D1Success[D1有效对话成功]
    ActiveConvo -->|否| ChatEnd[对话结束]
    
    D1Success --> PaywallTrigger{付费触发点?}
    PaywallTrigger -->|是| Paywall
    PaywallTrigger -->|否| ContinueChat[继续聊天]
    
    Paywall --> Subscribe{订阅成功?}
    Subscribe -->|是| UnlockFeatures[解锁深度功能]
    Subscribe -->|否| FreeTier[继续免费功能]
    
    UnlockFeatures --> DeepAstroReport[深度合盘报告]
    UnlockFeatures --> FateBoost[命定曝光提升]
    UnlockFeatures --> PriorityMatch[优先匹配]
    
    FreeTier --> ContinueChat
    ContinueChat --> Retention[用户留存]
    
    NextCard --> MoreCards{还有卡片?}
    MoreCards -->|是| AstroBadge
    MoreCards -->|否| RefreshFeed[刷新推荐]
    
    ChatEnd --> BackToHome[返回首页]
    BackToHome --> Home
    
    Retention --> DailyReturn[每日回流]
    DailyReturn --> Home
```

## 核心功能模块流程

### 1. 星盘信息采集流程
```mermaid
graph TD
    A[进入星盘采集页] --> B{已有出生信息?}
    B -->|是| C[显示现有信息]
    B -->|否| D[空白表单]
    
    C --> E[编辑模式]
    D --> F[填写出生日期]
    E --> F
    
    F --> G{出生时间?}
    G -->|知道| H[选择具体时间]
    G -->|不知道| I[选择大致时段]
    G -->|完全不知道| J[标记为未知]
    
    H --> K[准确度: accurate]
    I --> L[准确度: approximate]
    J --> M[准确度: unknown]
    
    K --> N[选择出生城市]
    L --> N
    M --> N
    
    N --> O[城市搜索联想]
    O --> P{找到城市?}
    P -->|是| Q[确认经纬度]
    P -->|否| R[手动输入/跳过]
    
    Q --> S[生成缘分画像]
    R --> S
    
    S --> T[埋点: astro_onboarding_submit]
    T --> U[返回主流程]
```

### 2. 双通道匹配流程
```mermaid
graph TD
    A[首页Match页面] --> B[顶部Segment切换]
    B --> C{选择通道}
    
    C -->|天选| D[今日天选算法]
    C -->|附近| E[附近可聊算法]
    
    D --> F[分桶策略 A/B/C]
    F --> G[合盘计算]
    G --> H[生成缘分徽章]
    H --> I[天选卡片展示]
    
    E --> J[地理+活跃筛选]
    J --> K{是否A档用户?}
    K -->|是| L[提升曝光频次]
    K -->|否| M[正常展示]
    L --> N[附近卡片展示]
    M --> N
    
    I --> O[用户交互]
    N --> O
    
    O --> P{点击徽章?}
    P -->|是| Q[轻报告弹层]
    P -->|否| R{滑动操作?}
    
    Q --> S[显示3-5条洞察]
    S --> T[今日宜聊话题]
    T --> U[3个开场白选项]
    U --> V{用户行为}
    
    V -->|复制开场白| W[开始对话]
    V -->|查看深报告| X[引导订阅]
    V -->|关闭| R
    
    R -->|喜欢| Y[发送Like]
    R -->|跳过| Z[下一张卡片]
    
    Y --> AA{匹配成功?}
    AA -->|是| BB[匹配弹窗+开场白]
    AA -->|否| Z
    
    BB --> W
    W --> CC[进入聊天]
```

### 3. 聊天增强流程
```mermaid
graph TD
    A[进入聊天界面] --> B[加载合盘数据]
    B --> C{有合盘结果?}
    
    C -->|是| D[显示顶部建议横条]
    C -->|否| E[普通聊天界面]
    
    D --> F[今日建议/雷区提醒]
    F --> G[输入区开场白按钮]
    
    G --> H{点击开场白?}
    H -->|是| I[显示3个建议]
    H -->|否| J[正常输入]
    
    I --> K{选择开场白?}
    K -->|是| L[插入到输入框]
    K -->|否| J
    
    L --> M[发送消息]
    J --> M
    E --> M
    
    M --> N[消息计数]
    N --> O{达到有效对话?}
    
    O -->|是| P[D1有效对话成功]
    O -->|否| Q[继续聊天]
    
    P --> R{付费触发条件?}
    R -->|匹配后| S[即时付费引导]
    R -->|对话热期| T[延迟付费引导]
    R -->|轻报告80%| U[深报告引导]
    R -->|否| Q
    
    S --> V[订阅页面]
    T --> V
    U --> V
    Q --> W[继续对话流程]
```

### 4. 订阅与变现流程
```mermaid
graph TD
    A[触发订阅页面] --> B[展示权益说明]
    B --> C[深度合盘报告]
    C --> D[命定配对优先曝光]
    D --> E[Fate Boost置顶]
    E --> F[当日时机提醒]
    
    F --> G{用户选择}
    G -->|订阅| H[支付流程]
    G -->|单次解锁| I[单次付费]
    G -->|关闭| J[返回免费功能]
    
    H --> K{支付成功?}
    I --> K
    
    K -->|是| L[解锁全部功能]
    K -->|否| M[支付失败处理]
    
    L --> N[深度报告访问]
    L --> O[优先匹配生效]
    L --> P[Fate Boost可用]
    
    N --> Q[用户留存提升]
    O --> Q
    P --> Q
    
    M --> R[重试/返回]
    R --> G
    
    J --> S[继续免费体验]
    S --> T[后续付费触点]
    T --> A
```

## 关键指标监控

### 转化漏斗
```mermaid
graph LR
    A[安装] --> B[注册]
    B --> C[星盘采集]
    C --> D[首次匹配]
    D --> E[发送消息]
    E --> F[有效对话]
    F --> G[付费转化]
    
    A1[100%] --> B1[85%]
    B1 --> C1[70%]
    C1 --> D1[60%]
    D1 --> E1[45%]
    E1 --> F1[30%]
    F1 --> G1[8%]
```

### 核心指标
- **获取**: 注册完成率、星盘信息完成率
- **激活**: TTFM(首条消息时间)、D1有效对话率
- **互动**: 天选点击率、轻报告查看率、开场白使用率
- **变现**: 付费页面查看率、订阅转化率、ARPPU
- **留存**: D1/D7/D30留存率、星盘功能回访率

## 技术实现优先级

### P0 (核心体验)
1. 星盘信息采集页面
2. 双通道首页(天选/附近)
3. 缘分徽章 + 轻报告
4. 聊天开场白集成

### P1 (变现关键)
1. 深度报告订阅
2. 付费触发点优化
3. 命定曝光算法

### P2 (体验增强)
1. 每日运势推送
2. Fate Boost功能
3. 个人星盘页面

这个流程图涵盖了从用户获取到变现的完整链路，你觉得哪个环节需要进一步细化？
